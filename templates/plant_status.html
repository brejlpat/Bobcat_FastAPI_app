{% extends "base.html" %}

{% block content %}
<section style="display: grid;">
    <h1 style="text-align: center; margin-bottom: 20px;">üìç Plant Line Status Overview</h1>
    <div style="display: flex; justify-content: center;">
        <object id="svg-plant" type="image/svg+xml" data="../static/svg/plant_plan.svg" width="100%" height="auto"></object>
    </div>
</section>

<!-- Modal (popup) -->
<div id="popup">
  <div class="popup-content">
    <button id="close-popup">&times;</button> <!-- ‚Üê Tady je ten k≈ô√≠≈æek -->
    <h2 id="popup-title"></h2>
    <p id="popup-content"></p>
  </div>
</div>

<script>
  document.getElementById("svg-plant").addEventListener("load", function () {
    const svgDoc = this.contentDocument;

    // Data z Pythonu p≈ôeveden√° do JSON form√°tu
    const tags = {{ tags | tojson }};

    // P≈ôevod do mapy: { "Blade_Mex": "RUNNING", ... }
    const statusMap = {};
    tags.forEach(tag => {
      statusMap[tag.name] = tag.value;
    });

    const statusColors = {
      RUNNING: "#4CAF50",     // zelen√°
      IDLE: "#2196F3",        // modr√°
      MAINTENANCE: "#9E9E9E", // ≈°ed√°
    };

    for (const [id, status] of Object.entries(statusMap)) {
      const group = svgDoc.getElementById(id);
      if (group) {
        const rect = group.querySelector("rect");
        if (rect) {
          rect.style.fill = statusColors[status] || statusColors.UNKNOWN;
        }
      }
    }
  });
</script>

<script>
  document.getElementById("svg-plant").addEventListener("load", function () {
    const svgDoc = this.contentDocument;

    const tags = {{ tags | tojson }};
    const statusMap = {};
    tags.forEach(tag => {
      statusMap[tag.name] = tag.value;
    });

    const statusColors = {
      RUNNING: "#4CAF50",
      IDLE: "#2196F3",
      MAINTENANCE: "#9E9E9E",
    };

    for (const [id, status] of Object.entries(statusMap)) {
      const group = svgDoc.getElementById(id);
      if (group) {
        const rect = group.querySelector("rect");
        if (rect) {
          rect.style.fill = statusColors[status] || statusColors.UNKNOWN;
        }

        group.style.cursor = "pointer";
        group.addEventListener("click", () => {
          document.getElementById("popup-title").innerText = `Detail linky: ${id}`;
          document.getElementById("popup-content").innerText = `Status: ${status}`;
          document.getElementById("popup").classList.add("show");
        });
      }
    }

    document.getElementById("close-popup").addEventListener("click", () => {
      document.getElementById("popup").classList.remove("show");
    });
  });
</script>

{% endblock %}
